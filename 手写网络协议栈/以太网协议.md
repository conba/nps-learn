# 以太网协议



以太网协议是现代计算机网络中最常用的局域网（LAN）技术之一，他定义了数据链路层和物理层规则（二层协议）。

## 1. 以太网的基本概念

* 定义：
  以太网是一组技术和协议的集合，主要由**IEEE**指定，标准被 **IEEE 802.3**

## 2. 以太网的结构和原理
以太网规定了数据在网络中的封装格式和传输方式，包括一下几个核心部分

### 2.1 以太网帧数据结构
以太网帧（Frame）来封装和传输数据，标准以太网帧的格式如下：

| 字段          | 长度（字节）  | 说明                      |
| ----------- | ------- | ----------------------- |
| **前导码**     | 7       | 同步信号，帮助接受设备锁定帧的起始位置     |
| **帧起始定界符**  | 1       | 标记帧的开始，通常是10101011      |
| **目标MAC地址** | 6       | 数据帧的接受方MAC地址            |
| **源MAC地址**  | 6       | 数据帧的发送方MAC地址            |
| **以太类型/长度** | 2       | 数据帧的类型（如IPv4、IPv6）或帧的长度 |
| **数据/填充**   | 46-1500 | 实际数据负载，若不足46字节许填充       |
| **帧校验序列**   | 4       | 用于检测帧传输中的错误             |

### 2.2 MAC地址

* 每个以太网设备都有一个唯一的MAC地址，通常由6字节（48位）组成
* 前3字节：厂商表示
* 后3字节：厂商分配的设备表示

### 2.3数据传输原理

* 介质访问控制（MAC）
  以太网采用CSMA/CD（载波监听多路访问/碰撞检测）技术：

* 帧校验
  帧校验序列（FCS）采用循环冗余校验（CRC）算法，接收方通过校验确保数据帧的完成性。

## 3. 以太网的主要特性

* 传输速率：初期为10Mbps,目前主流支持10Gbps,40Gbps和100Gbps
* 全双工模式

## 数据包结构

![](image\以太网帧头.svg)



以太网帧头（Ethernet Frame Header）是以太网通信中用于传输数据的一个重要数据结构。标准以太网帧头的长度是**14字节**，

1. 目标MAC地址（**Destination MAC Address, 6字节**）

2. 源MAC地址（6字节）

3. 类型/长度字段（Type/Length, 2字节）

   类型字段：标识数据部分所使用的协议（如IP协议，ARP协议等），以十六进制表示：

   **0x0800: IPv4**

   **0x0806: ARP**

   **0x86DD:IPV6**

   长度字段（Length）：在某些情况下可以表示数据的长度，适用于IEEE 802.3标准

## 以太网帧后面的内容

帧头后面是数据负载部分和帧尾

* 数据负载（Payload）：46~1500字节，包含实际传输的数据
* 帧校验系列（FCS，Frame Check Sequence）：4字节，用于检测数据传输过程中的错误。

## 总结

标准以太网帧的总长度是**64~1518字节**

* 帧头：14字节
* 数据负载：46~1500字节
* FCS：4字节

## 大端字节序和小端字节序

假设变量x是一个32为的整数，值为**0x12345678**

* 大端

```
1. 地址：0x00 0x01 0x02 0x03
2. 数据：12   34   56   78
```

* 小端

```
1. 地址：0x00 0x01 0x02 0x03
2. 数据：78   56   34   12
```

## 字节序的影响范围

1. 网络传输：

   **网络字节序**通常采用大端字节序

   在**传输数据**时，需要讲数据转化为同意的字节序，发送方和接收方约定一致

## 常见的处理字节序的函数

**htonl** / **htons**：主机字节序转化为网络字节序

**ntohl** / **ntohs**：网络字节序转化为主机字节序

   
